"use strict";function ownKeys(t,e){var r,a=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,r)),a}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i=[],s=!0,o=!1;try{for(r=r.call(e);!(s=(a=r.next()).done)&&(i.push(a.value),!t||i.length!==t);s=!0);}catch(e){o=!0,n=e}finally{try{s||null==r.return||r.return()}finally{if(o)throw n}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var targetOrigin=document.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),docClientWidth=document.documentElement.clientWidth,docClientHeight=document.documentElement.clientHeight,cssHref=(-1!==location.href.indexOf("taikang")?"http://10.132.23.192":"http://10.154.31.90")+"/starlinkdashboard",productionUrl="http://oa.taikang.com",uatUrl="http://oa.tkuat.com";function setObjectToUrlParams(e){for(var t="",r=0,a=Object.entries(e);r<a.length;r++){var n=_slicedToArray(a[r],2),i=n[0],n=n[1];t+="".concat(i,"=").concat(n,"&")}return t}function setDrawerStyles(e){document.querySelector("#starlinkdashboard-iframe-container").setAttribute("style",{true:"left: 0",false:"left: 100%"}[e]),document.querySelector("#dashboard-iframe-close-btn").setAttribute("style",{true:"visibility: visible",false:"visibility: hidden"}[e])}function getQueryVariable(e,t){for(var r=e.substring(e.indexOf("?")+1).split("&"),a=0;a<r.length;a++){var n=r[a].split("=");if(n[0]===t)return n[1]}}var StarlinkDashBoard=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this.options=_objectSpread({systemCode:"",title:"星链看板",commonOriSelfPageJump:"_blank",commonOriOtherPageJump:"_blank"},e),this.storageFlag=!1,this.initFlag=!1,this.openStatus=!1,this.openDrawer=this.openDrawer.bind(this),this.closeDrawer=this.closeDrawer.bind(this),this.onMessageHandle=this.onMessageHandle.bind(this),this.onVisibilityChangeHandle=this.onVisibilityChangeHandle.bind(this),this.init()}return _createClass(t,[{key:"init",value:function(){this.bind();var e=this.options,t=e.systemCode,e=e.title;t?this.initEntryElement(cssHref+"/starlinkEntry/starlinkEntry.css",e):window.alert("星链看板初始化不成功，缺少系统编码参数")}},{key:"bind",value:function(){window.addEventListener("message",this.onMessageHandle,!1),document.addEventListener("visibilitychange",this.onVisibilityChangeHandle)}},{key:"initEntryElement",value:function(e,t){var r=this;[{createEle:"link",targetEle:"head",attribute:{rel:"stylesheet",type:"text/css",href:e}},{createEle:"div",targetEle:"body",attribute:{id:"starlinkdashboard-iframe-container",className:"dashboard-iframe-containerClass",style:"visibility: hidden"}},{createEle:"span",targetEle:"#starlinkdashboard-iframe-container",attribute:{id:"dashboard-iframe-close-btn",className:"dashboard-iframe-close-btn",title:"关闭".concat(t),innerText:"✖",style:"visibility: hidden"},handleName:"iframeButtonHandle"},{createEle:"div",targetEle:"#starlinkdashboard-iframe-container",attribute:{id:"starlinkdashboard-iframe-widget",width:"0",height:"100%"}}].map(function(e){r.insertElement(e)})}},{key:"insertElement",value:function(e){var t=e.createEle,r=e.targetEle,a=e.attribute,e=e.handleName,n=document.createElement(t);a&&Object.keys(a).map(function(e){n[e]=a[e]}),document.querySelector(r).appendChild(n),e&&this.handleEvent(n,e)}},{key:"handleEvent",value:function(e,t){"iframeButtonHandle"===t&&this.iframeButtonHandle(e)}},{key:"iframeButtonHandle",value:function(e){var t=this;e.onclick=function(e){e.preventDefault(),t.closeDrawer()}}},{key:"closeDrawer",value:function(){setDrawerStyles("false"),document.querySelector("#starlinkdashboard-iframe-widget").innerHTML="",sessionStorage.removeItem("starlinkdashboard-storage-urls"),this.openStatus=!1,this.initFlag=!1}},{key:"openDrawer",value:function(e){var t;this.openStatus||(e=setObjectToUrlParams(e.params),t=this.options.systemCode,e=(-1!==location.href.indexOf("taikang")?productionUrl:uatUrl)+"/starlinkdashboard/".concat(t,"/dashboard?").concat(e)+"currentDashboard=".concat(t,"&oriDashboard=").concat(t,"&storageID=").concat((new Date).valueOf(),"&storageIndex=0"),this.initIframeElementAndUrl(e),this.openStatus||(setDrawerStyles("true"),this.openStatus=!0))}},{key:"initIframeElementAndUrl",value:function(e){var t=this;document.querySelector("#starlinkdashboard-iframe-widget").innerHTML="",e=e.endsWith("&")?e.substring(0,e.length-1):e,this.insertElement({createEle:"iframe",targetEle:"#starlinkdashboard-iframe-widget",attribute:{id:"starlinkdashboard-iframe",className:"dashboard-iframe-widgetClass",width:docClientWidth+"px",height:docClientHeight+"px",frameborder:"0",scrolling:"no",style:"border: none",seamless:"seamless",src:e}}),document.getElementById("starlinkdashboard-iframe").onload=function(){t.initFlag||(t.initFlag=!0)}}},{key:"postMessageHandle",value:function(e){e.targetOrigin=targetOrigin,e.postMessageName="starlinkdashboard",document.getElementById("starlinkdashboard-iframe").contentWindow.postMessage(e,"*")}},{key:"onMessageHandle",value:function(e){var t=e.data;e.origin===t.targetOrigin&&"starlinkdashboard"===t.postMessageName&&("init"===t.postMessageType&&t.params&&(e=t.params.url,this.storageUrl(e)),"fallback"!==t.postMessageType&&"jumpDashboard"!==t.postMessageType||!t.params||(e=t.params.url,this.initIframeElementAndUrl(e)),"jumpOtherSystemPage"===t.postMessageType&&t.params&&(e=t.params.url,"_blank"!==this.options.commonOriOtherPageJump&&this.closeDrawer(),window.open(e,this.options.commonOriOtherPageJump)))}},{key:"storageUrl",value:function(e){var t=JSON.parse(sessionStorage.getItem("starlinkdashboard-storage-urls"))||{},r=getQueryVariable(e,"storageID")||"",a=getQueryVariable(e,"storageIndex")||"",n=t.urls||[];r&&((t=t.storageID!==r+""?{}:t).storageID=r,a?n[a]=e:n.push(e),t.urls=n,sessionStorage.setItem("starlinkdashboard-storage-urls",JSON.stringify(t)),this.openStatus&&this.postMessageHandle({storage:!0,storageData:JSON.stringify(t)}))}},{key:"onVisibilityChangeHandle",value:function(e){"visible"===document.visibilityState&&this.openStatus&&this.postMessageHandle({refresh:!0}),"hidden"===document.visibilityState&&this.openStatus&&this.postMessageHandle({resetRefresh:!0})}}]),t}();window.StarlinkDashBoard=StarlinkDashBoard;